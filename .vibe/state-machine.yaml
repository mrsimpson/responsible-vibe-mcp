name: "Explore-Plan-Code-Commit Workflow"
description: "A comprehensive development workflow based on Anthropic's best practices: Explore, Plan, Code, Commit based on https://www.anthropic.com/engineering/claude-code-best-practices"
initial_state: "explore"

states:
  explore:
    description: "Research and exploration phase - understanding the problem space"
    transitions:
      - trigger: "exploration_complete"
        to: "plan"
        instructions: "Exploration complete! You've gathered sufficient information about the codebase, requirements, and constraints. Now think hard about creating a comprehensive plan. Make sure you documented knowledge in the plan"
        transition_reason: "Sufficient exploration completed, ready to plan"

      - trigger: "continue_exploring"
        to: "explore"
        instructions: "Continue exploring the codebase and problem space. Read relevant files, understand existing patterns, and gather more context. Don't write any code yet - focus on understanding. Document knowledge in the plan"
        transition_reason: "More exploration needed"

  plan:
    description: "Planning phase - creating a detailed implementation strategy"
    transitions:
      - trigger: "plan_complete"
        to: "code"
        instructions: "You've thought through the approach thoroughly and created a solid strategy. Now implement the solution step by step, verifying the reasonableness of each piece as you build it. Implement automated tests where appropriate"
        transition_reason: "Comprehensive plan created, ready to implement"

      - trigger: "need_more_exploration"
        to: "explore"
        instructions: "The planning revealed gaps in understanding. Gather more information about the codebase, requirements, or constraints before continuing with the plan. You may need to revert artifacts you've already created."
        transition_reason: "Planning revealed knowledge gaps"

      - trigger: "refine_plan"
        to: "plan"
        instructions: "Continue refining the plan. Think harder about edge cases, alternative approaches, and potential issues. Consider creating a document or GitHub issue with your plan for future reference. You may need to revert artifacts you've already created."
        transition_reason: "Plan needs more refinement"

  code:
    description: "Implementation phase - writing and building the solution"
    transitions:
      - trigger: "implementation_complete"
        to: "commit"
        instructions: "Implementation complete! The code is working and meets the requirements. Update Plan, READMEs, changelogs, documentation. Commit the code with a clear explanation of what was implemented and why."
        transition_reason: "Implementation finished successfully"

      - trigger: "implementation_issues"
        to: "plan"
        instructions: "Implementation revealed issues with the plan. Go back to planning to address the problems discovered during coding. Think through alternative approaches."
        transition_reason: "Implementation revealed planning issues"

      - trigger: "continue_coding"
        to: "code"
        instructions: "Continue implementing the solution. Follow the plan step by step, verify the reasonableness of each component as you build it, and maintain good coding practices."
        transition_reason: "Implementation in progress"

      - trigger: "need_exploration"
        to: "explore"
        instructions: "Implementation revealed the need for more exploration. Investigate the codebase further to understand how to properly integrate your changes."
        transition_reason: "Implementation requires more exploration"

  commit:
    description: "Finalization phase - committing changes and documentation"
    transitions:
      - trigger: "commit_complete"
        to: "explore"
        instructions: "Changes committed successfully! Pull request created with proper documentation. Ready to start the next development cycle. Begin by exploring what to work on next."
        transition_reason: "Development cycle complete, starting fresh"

      - trigger: "need_code_fixes"
        to: "code"
        instructions: "Issues found during commit preparation. Return to implementation to fix the problems before committing."
        transition_reason: "Code needs fixes before commit"

      - trigger: "continue_commit_prep"
        to: "commit"
        instructions: "Continue preparing the commit. Update Plan, READMEs, changelogs, documentation. Commit the code with a clear explanation of what was implemented and why."
        transition_reason: "Commit preparation in progress"

direct_transitions:
  - state: "explore"
    instructions: "Starting exploration phase. Read relevant files, understand the codebase structure, and gather context about the problem. Ask the user for clarification. Propose alternatives and illustrate them without code, highlight the options impact on the overall architecture and semantical differences compared to other options. Use general pointers or specific filenames, but don't write any code yet."
    transition_reason: "Beginning development cycle with exploration"

  - state: "plan"
    instructions: "Starting planning phase. Think hard about the implementation approach. Use 'think harder' or 'ultrathink' to evaluate alternatives thoroughly. Create a comprehensive plan that addresses the requirements and constraints you've discovered."
    transition_reason: "Direct transition to planning phase"

  - state: "code"
    instructions: "Starting implementation phase. Follow your plan step by step, implementing the solution while verifying the reasonableness of each component. Maintain good coding practices and test as you go."
    transition_reason: "Direct transition to implementation phase"

  - state: "commit"
    instructions: "Starting commit preparation phase. Finalize your implementation, update documentation, create clear commit messages, and prepare a pull request with proper explanation of the changes."
    transition_reason: "Direct transition to commit phase"